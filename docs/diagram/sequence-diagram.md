# 암호화폐 분석 프로젝트 Sequence Diagram

## 📊 Phase 2: 포트폴리오 분석기 시퀀스 다이어그램

```
사용자          main.py       portfolio_analyzer.py    api_client.py     업비트API       format_utils.py
  │               │                    │                    │              │                │
  │─── 1 선택 ──→│                    │                    │              │                │
  │               │                    │                    │              │                │
  │               │──── run_portfolio_analyzer() ──────→│     │              │                │
  │               │                    │                    │              │                │
  │               │                    │── get_sample_portfolio() ──→│     │              │                │
  │               │                    │                    │              │                │
  │               │                    │◄──── portfolio ─────────────│     │              │                │
  │               │                    │                    │              │                │
  │               │                    │── validate_portfolio() ────→│     │              │                │
  │               │                    │                    │              │                │
  │               │                    │◄──── True ──────────────────│     │              │                │
  │               │                    │                    │              │                │
  │               │                    │── get_current_prices_api() ─→│     │              │                │
  │               │                    │                    │              │                │
  │               │                    │                    │── get_current_prices() ──→│  │                │
  │               │                    │                    │              │                │
  │               │                    │                    │              │── HTTP GET ─→│  │
  │               │                    │                    │              │                │
  │               │                    │                    │              │◄── JSON ────│  │
  │               │                    │                    │              │                │
  │               │                    │                    │◄── prices ──│              │                │
  │               │                    │                    │              │                │
  │               │                    │◄── prices ───────────────────│     │              │                │
  │               │                    │                    │              │                │
  │               │                    │── analyze_portfolio() ──────→│     │              │                │
  │               │                    │                    │              │                │
  │               │                    │   (가치 계산 루프)            │              │                │
  │               │                    │   for market, quantity:       │              │                │
  │               │                    │     value = price * quantity   │              │                │
  │               │                    │     total_value += value       │              │                │
  │               │                    │                    │              │                │
  │               │                    │   (비중 계산 루프)            │              │                │
  │               │                    │   for item:                    │              │                │
  │               │                    │     percentage = value/total*100│             │                │
  │               │                    │                    │              │                │
  │               │                    │◄── analysis_result ──────────│     │              │                │
  │               │                    │                    │              │                │
  │               │                    │── print_portfolio_summary() ─→│     │              │                │
  │               │                    │                    │              │                │
  │               │                    │                    │              │                │──── format_currency() ──→│
  │               │                    │                    │              │                │                │
  │               │                    │                    │              │                │◄── formatted ────────────│
  │               │                    │                    │              │                │                │
  │               │                    │── print_portfolio_table() ───→│     │              │                │
  │               │                    │                    │              │                │                │
  │               │                    │                    │              │                │──── create_table_header() ──→│
  │               │                    │                    │              │                │                │
  │               │                    │                    │              │                │◄── table_header ─────────────│
  │               │                    │                    │              │                │                │
  │               │                    │                    │              │                │──── create_table_row() ──────→│
  │               │                    │                    │              │                │                │
  │               │                    │                    │              │                │◄── table_row ────────────────│
  │               │                    │                    │              │                │                │
  │               │◄──── 결과 출력 ──────────────────────│     │              │                │
  │               │                    │                    │              │                │                │
  │◄── 분석 완료 ─│                    │                    │              │                │                │
```

---

## 🔔 Phase 3: 가격 알림 시스템 시퀀스 다이어그램

```
사용자         main.py       price_alert.py       api_client.py      업비트API        date_utils.py
  │              │                 │                    │               │                 │
  │─── 2 선택 ─→│                 │                    │               │                 │
  │              │                 │                    │               │                 │
  │              │─── run_price_alert() ──────────→│    │               │                 │
  │              │                 │                    │               │                 │
  │              │                 │── get_preset_alert_settings() ─→│  │               │                 │
  │              │                 │                    │               │                 │
  │              │                 │── get_single_price_api() ──────→│  │               │                 │
  │              │                 │                    │               │                 │
  │              │                 │                    │── get_single_price() ──→│     │                 │
  │              │                 │                    │               │                 │
  │              │                 │                    │               │── HTTP GET ──→│  │
  │              │                 │                    │               │                 │
  │              │                 │                    │               │◄── JSON ─────│  │
  │              │                 │                    │               │                 │
  │              │                 │                    │◄── price ────│               │                 │
  │              │                 │                    │               │                 │
  │              │                 │◄── current_price ─────────────────│               │                 │
  │              │                 │                    │               │                 │
  │              │                 │── calculate_target_prices() ──→│   │               │                 │
  │              │                 │                    │               │                 │
  │              │                 │◄── (high, low) ─────────────────│   │               │                 │
  │              │                 │                    │               │                 │
  │              │                 │── price_alert_system() ─────────→│   │               │                 │
  │              │                 │                    │               │                 │
  │              │                 │── display_monitoring_info() ────→│   │               │                 │
  │              │                 │                    │               │                 │
  │              │                 │                    │               │                 │── get_current_time() ──→│
  │              │                 │                    │               │                 │                 │
  │              │                 │                    │               │                 │◄── time_string ─────────│
  │              │                 │                    │               │                 │                 │
  │              │                 │   ┌─────────────── 모니터링 루프 ──────────────┐    │                 │
  │              │                 │   │                │               │          │    │                 │
  │              │                 │   │── get_single_price_api() ──→│   │               │          │    │                 │
  │              │                 │   │                │               │          │    │                 │
  │              │                 │   │                │── get_single_price() ──→│     │          │    │                 │
  │              │                 │   │                │               │          │    │                 │
  │              │                 │   │                │               │── HTTP GET ──→│          │    │                 │
  │              │                 │   │                │               │          │    │                 │
  │              │                 │   │                │               │◄── JSON ─────│          │    │                 │
  │              │                 │   │                │               │          │    │                 │
  │              │                 │   │                │◄── price ────│               │          │    │                 │
  │              │                 │   │                │               │          │    │                 │
  │              │                 │   │◄── current_price ─────────────────────────│               │          │    │                 │
  │              │                 │   │                │               │          │    │                 │
  │              │                 │   │── check_price_alert_condition() ─────────→│    │               │          │    │                 │
  │              │                 │   │                │               │          │    │                 │
  │              │                 │   │◄── alert_result ──────────────────────────│    │               │          │    │                 │
  │              │                 │   │                │               │          │    │                 │
  │              │                 │   │── display_monitoring_status() ────────────→│    │               │          │    │                 │
  │              │                 │   │                │               │          │    │                 │
  │              │                 │   │                │               │          │    │                 │── get_current_time() ──→│
  │              │                 │   │                │               │          │    │                 │                 │
  │              │                 │   │                │               │          │    │                 │◄── time_string ─────────│
  │              │                 │   │                │               │          │    │                 │                 │
  │              │                 │   │                │               │          │    │                 │                 │
  │              │                 │   │   (if alert_triggered)        │          │    │                 │                 │
  │              │                 │   │─── "🔴 상한가 도달!" 출력 ──│    │               │          │    │                 │                 │
  │              │                 │   │   or "🔵 하한가 도달!" 출력   │               │          │    │                 │                 │
  │              │                 │   │   or "✅ 정상 범위" 출력      │               │          │    │                 │                 │
  │              │                 │   │                │               │          │    │                 │                 │
  │              │                 │   │   (sleep interval seconds)     │               │          │    │                 │                 │
  │              │                 │   │                │               │          │    │                 │                 │
  │              │                 │   └─────────────── 루프 반복 ──────────────┘    │                 │
  │              │                 │                    │               │                 │
  │              │                 │◄── monitoring_result ──────────────│               │                 │
  │              │                 │                    │               │                 │
  │              │◄── 알림 완료 ──────────────────────│                │               │                 │
  │              │                 │                    │               │                 │
  │◄── 모니터링 종료 ──│             │                    │               │                 │
```

---

## 📈 Phase 4: 수익률 계산기 시퀀스 다이어그램

```
사용자         main.py      return_calculator.py     api_client.py       업비트API       date_utils.py    format_utils.py
  │              │                 │                      │                │                │                 │
  │─── 3 선택 ─→│                 │                      │                │                │                 │
  │              │                 │                      │                │                │                 │
  │              │─── run_return_calculator() ──────→│     │                │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │── get_user_investment_settings() ─→│  │                │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │◄── settings ────────────────────────│  │                │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │── calculate_investment_return() ────→│  │                │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │── get_historical_data_api() ────────→│  │                │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │                      │── get_historical_data() ──→│   │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │                      │                │── HTTP GET ──→│  │                │                 │
  │              │                 │                      │                │   (candles/days) │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │                      │                │◄── JSON Array ─│  │                │                 │
  │              │                 │                      │                │   (일봉 데이터) │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │                      │◄── historical_data ──────│     │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │◄── historical_data ────────────────────│            │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │── find_investment_date_price() ─────→│  │                │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │   (데이터 인덱싱: data[days_ago-1])   │                │                │                 │
  │              │                 │   (가격 추출: trade_price)           │                │                │                 │
  │              │                 │   (날짜 추출: candle_date_time_kst)   │                │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │◄── (price, date) ──────────────────────│              │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │── get_single_price_api() ────────────→│  │                │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │                      │── get_single_price() ──→│      │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │                      │                │── HTTP GET ──→│  │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │                      │                │◄── JSON ─────│  │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │                      │◄── current_price ─────│        │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │◄── current_price ──────────────────────│              │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │   ┌────────────── 수익률 계산 ────────────┐          │                │                 │
  │              │                 │   │ purchase_quantity = amount / inv_price │          │                │                 │
  │              │                 │   │ current_value = quantity * curr_price  │          │                │                 │
  │              │                 │   │ profit_loss = current_value - amount   │          │                │                 │
  │              │                 │   │ return_rate = (profit/amount) * 100    │          │                │                 │
  │              │                 │   └──────────────────────────────────────┘          │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │── calculate_annual_return_rate() ────→│  │                │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │◄── annual_rate ─────────────────────────│              │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │◄── calculation_result ──────────────────│              │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │── print_investment_result() ─────────→│  │                │                │                 │
  │              │                 │                      │                │                │                 │
  │              │                 │                      │                │                │                 │── format_currency() ──→│
  │              │                 │                      │                │                │                 │                 │
  │              │                 │                      │                │                │                 │◄── "1,000,000원" ─────│
  │              │                 │                      │                │                │                 │                 │
  │              │                 │                      │                │                │                 │── format_percentage() ─→│
  │              │                 │                      │                │                │                 │                 │
  │              │                 │                      │                │                │                 │◄── "12.34%" ──────────│
  │              │                 │                      │                │                │                 │                 │
  │              │                 │                      │                │                │── get_date_days_ago() ──→│     │
  │              │                 │                      │                │                │                 │                 │
  │              │                 │                      │                │                │◄── past_date ─────────────│     │
  │              │                 │                      │                │                │                 │                 │
  │              │                 │   ┌─────────────── 결과 출력 ──────────────┐         │                │                 │
  │              │                 │   │ 📈 BTC 투자 수익률 분석 결과          │         │                │                 │
  │              │                 │   │ 투자일자: 2024-01-01 (30일 전)        │         │                │                 │
  │              │                 │   │ 투자금액: 1,000,000원                 │         │                │                 │
  │              │                 │   │ 투자시점: 50,000,000원                │         │                │                 │
  │              │                 │   │ 현재가격: 55,000,000원                │         │                │                 │
  │              │                 │   │ 손익: +100,000원                      │         │                │                 │
  │              │                 │   │ 수익률: +10.00%                       │         │                │                 │
  │              │                 │   │ 연간수익률: +121.90%                  │         │                │                 │
  │              │                 │   │ 평가: 😊 수익을 실현했습니다.         │         │                │                 │
  │              │                 │   └─────────────────────────────────────┘         │                │                 │
  │              │                 │                      │                │                │                 │
  │              │◄── 분석 완료 ──────────────────────────│                │                │                 │
  │              │                 │                      │                │                │                 │
  │◄── 결과 확인 ─│                 │                      │                │                │                 │
```

---

## 🔄 공통 API 호출 시퀀스 다이어그램

```
Module          api_client.py       requests         업비트 API 서버      Response Handler
  │                  │                │                     │                    │
  │── API 요청 ────→│                │                     │                    │
  │                  │                │                     │                    │
  │                  │── make_api_request() ──→│            │                    │
  │                  │                │                     │                    │
  │                  │   ┌─────────── 재시도 루프 (최대 3회) ──────────┐         │
  │                  │   │            │                     │          │         │
  │                  │   │            │── HTTP GET ────────→│          │         │
  │                  │   │            │   + timeout=10s     │          │         │
  │                  │   │            │                     │          │         │
  │                  │   │            │                     │── 처리 ──│         │
  │                  │   │            │                     │          │         │
  │                  │   │            │                     │          │         │
  │                  │   │   ┌──── 성공? ─────┐             │          │         │
  │                  │   │   │               │             │          │         │
  │                  │   │   ▼ YES           ▼ NO          │          │         │
  │                  │   │ ┌─────────┐   ┌─────────────┐     │          │         │
  │                  │   │ │ JSON    │   │ Exception   │     │          │         │
  │                  │   │ │ 반환    │   │ 발생        │     │          │         │
  │                  │   │ └─────────┘   └─────────────┘     │          │         │
  │                  │   │   │               │             │          │         │
  │                  │   │   │               │             │          │         │
  │                  │   │   │               ▼             │          │         │
  │                  │   │   │         ┌─────────────┐     │          │         │
  │                  │   │   │         │ 1초 대기    │     │          │         │
  │                  │   │   │         │ 후 재시도   │     │          │         │
  │                  │   │   │         └─────────────┘     │          │         │
  │                  │   │   │               │             │          │         │
  │                  │   └───┼───────────────┼─────────────┘          │         │
  │                  │       │               │                        │         │
  │                  │       │               └──── 최대 3회 초과시 ────┼───→ None │
  │                  │       │                              │         │         │
  │                  │       │◄── JSON 데이터 ─────────────│         │         │
  │                  │       │                              │         │         │
  │                  │       │                              │         │── 데이터 검증 ──→│
  │                  │       │                              │         │         │
  │                  │       │                              │         │◄── 검증된 결과 ──│
  │                  │       │                              │         │         │
  │                  │◄── 결과 반환 ─────────────────────────│         │         │
  │                  │                              │         │         │
  │◄── 데이터 ──────│                              │         │         │
```

---

## 🏗️ 에러 처리 시퀀스 다이어그램

```
User Input       Validation       API Call         Error Handler      User Interface
    │                │               │                  │                  │
    │── 입력 데이터 ─→│               │                  │                  │
    │                │               │                  │                  │
    │                │── 검증 ──→ ❌ │                  │                  │
    │                │               │                  │                  │
    │                │               │                  │── 입력 오류 ──→│
    │                │               │                  │                  │
    │                │               │                  │                  │── "❌ 잘못된 입력" ─→│
    │◄───────────────┼───────────────┼──────────────────┼──────────────────┼──────────────────────│
    │                │               │                  │                  │
    │── 수정된 입력 ─→│               │                  │                  │
    │                │               │                  │                  │
    │                │── 검증 ──→ ✅ │                  │                  │
    │                │               │                  │                  │
    │                │               │── API 호출 ──→ ❌ │                  │
    │                │               │   (네트워크 오류)  │                  │
    │                │               │                  │                  │
    │                │               │                  │── API 오류 ──→│  │
    │                │               │                  │                  │
    │                │               │                  │                  │── "❌ 네트워크 오류\n재시도 중..." ─→│
    │                │               │                  │                  │
    │                │               │── 재시도 ──→ ✅  │                  │
    │                │               │                  │                  │
    │                │               │◄── 성공 데이터 ──│                  │
    │                │               │                  │                  │
    │                │               │                  │                  │── "✅ 성공" ────────→│
    │◄───────────────┼───────────────┼──────────────────┼──────────────────┼──────────────────────│
```

이 시퀀스 다이어그램들은 각 Phase의 상호작용 흐름과 API 호출 패턴, 에러 처리 과정을 시간 순서대로 보여줍니다.